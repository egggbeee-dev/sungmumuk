<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가게 비교</title>
    <link rel="icon" href="성뭐먹3.png" type="image/png">
    <link rel="stylesheet" href="compare.css"> <!-- 게시글 스타일 -->
    <link rel="stylesheet" href="header_footer.css"> <!-- 헤더와 푸터 스타일 -->
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

    <script src="header_footer.js" defer></script> <!-- 헤더 및 푸터 동적 로드 -->
</head>
<body>
       <!-- 헤더 동적 로드 -->
       <div id="header-placeholder"></div>

    <!-- 제목 섹션 -->
    <div class="page-header">
        가게 비교
    </div>
    <div class="comparison-container">
            <!-- 푸터 동적 로드 -->
    <div id="footer-placeholder"></div>
    
 <script src="media_query.js"></script>
    <!-- 반응형 -->
  </body>


    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const authResponse = await fetch('/auth/status');
                const authStatus = await authResponse.json();
        
                if (!authStatus.loggedIn) {
                    alert('비교함은 로그인 후 이용 가능합니다.');
                    window.location.href = '/login.html';
                    return;
                }
        
                const response = await fetch('/compare');
                if (!response.ok) throw new Error('데이터 가져오기에 실패했습니다.');
        
                const stores = await response.json();
                if (stores.length > 0) {
                    renderComparison(stores);
                } else {
                    document.querySelector('.comparison-container').innerHTML = `
                        <p>비교함에 추가된 가게가 없습니다.</p>
                    `;
                }
            } catch (error) {
                console.error('비교 데이터 로드 중 오류:', error);
            }
        });
    
        
        // HTML 렌더링 함수
        function renderComparison(stores) {
            const container = document.querySelector('.comparison-container');
        
            // HTML 렌더링
            container.innerHTML = stores
                .map(store => {
                    // 대표 이미지가 없을 경우 기본 이미지 사용
                    const representativeImage = store.representative_image || '/images/default-image.jpg';
        
                    // 영업시간 필드
                    const days = ['월요일', '화요일', '수요일', '목요일', '금요일', '토요일', '일요일'];
                    const hours = [
                        store.opening_hours_mon,
                        store.opening_hours_tue,
                        store.opening_hours_wed,
                        store.opening_hours_thu,
                        store.opening_hours_fri,
                        store.opening_hours_sat,
                        store.opening_hours_sun
                    ];
                    const openingHours = days.map((day, index) => {
                        return `<tr><td>${day}</td><td>${hours[index] || '정보 없음'}</td></tr>`;
                    }).join('');
        
                    // HTML 템플릿
                    return `
                        <div class="store">
                            <div class="store-header">
                                <img src="${representativeImage}" alt="가게 이미지" class="store-image">
                                <h2 class="store-name">${store.restaurant_name}</h2>
                                <button class="register-button">가게 등록</button>
                            </div>
                            <div class="store-details">
                                <p><strong>주소:</strong> ${store.address || '정보 없음'}</p>
                                <p><strong>캠퍼스:</strong> ${store.campus || '정보 없음'}</p>
                                <p><strong>카테고리:</strong> ${store.category || '정보 없음'}</p>
                                <p><strong>평균 가격:</strong> ${store.average_price || '정보 없음'}</p>
                                <p><strong>연락처:</strong> ${store.contact_number || '정보 없음'}</p>
                                <p><strong>제휴:</strong> ${store.partnership || '제휴 없음'}</p>
                                <h3>영업시간:</h3>
                                <table>
                                    <tr><th>요일</th><th>영업시간</th></tr>
                                    ${openingHours}
                                </table>
                            </div>
                        </div>
                    `;
                })
                .join('');
        }
        
        
    </script>

</html>
