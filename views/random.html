<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ëœë¤ì¶”ì²œ</title>
    <link rel="icon" href="ì„±ë­ë¨¹3.png" type="image/png" />
    <link rel="stylesheet" href="random.css" />
    <!-- ê¸°ì¡´ CSS íŒŒì¼ì„ ë§í¬ -->
    <link rel="stylesheet" href="header_footer.css" />
    <!-- í—¤ë”ì™€ í‘¸í„° ìŠ¤íƒ€ì¼ -->
    <!-- Google Fonts -->
  <!-- ìŠ¤íƒ€ì¼ -->
  <link
  href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
  rel="stylesheet"
/>
  </head>

  <!-- Header Placeholder -->
  <div id="header-placeholder"></div>
  <body>
    <!-- Main Content -->
    <main class="random-container">
      <div class="recommend-box">
        <h1>ğŸ‰ëœë¤ì¶”ì²œğŸ‰</h1>
      </div>
      <div class="options-box">
        <div class="option-group" id="food-options">
          <h2>ìŒì‹ ì„ íƒ</h2>
          <span class="option" onclick="toggleOption(this, 'food', 'ì „ì²´')"
            >ì „ì²´</span
          >
          <span class="option" onclick="toggleOption(this, 'food', 'ì¼ì‹')"
            >ì¼ì‹</span
          >
          <span class="option" onclick="toggleOption(this, 'food', 'ì¤‘ì‹')"
            >ì¤‘ì‹</span
          >
          <span class="option" onclick="toggleOption(this, 'food', 'í•œì‹')"
            >í•œì‹</span
          >
          <span class="option" onclick="toggleOption(this, 'food', 'ì–‘ì‹')"
            >ì–‘ì‹</span
          >
          <span
            class="option"
            onclick="toggleOption(this, 'food', 'ìƒëŸ¬ë“œ/í¬ì¼€')"
            >ìƒëŸ¬ë“œ/í¬ì¼€</span
          >
          <span class="option" onclick="toggleOption(this, 'food', 'ìˆ ì§‘')"
            >ìˆ ì§‘</span
          >
          <span class="option" onclick="toggleOption(this, 'food', 'ë””ì €íŠ¸')"
            >ë””ì €íŠ¸</span
          >
        </div>
        <div class="option-group" id="visit-options">
          <h2>ë°©ë¬¸ ì¸ì› ì„ íƒ</h2>
          <span class="option" onclick="toggleOption(this, 'visit', '1ì¸')"
            >1ì¸</span
          >
          <span class="option" onclick="toggleOption(this, 'visit', '2ì¸~4ì¸')"
            >2ì¸ ~ 4ì¸</span
          >
          <span class="option" onclick="toggleOption(this, 'visit', 'ë‹¨ì²´')"
            >ë‹¨ì²´</span
          >
        </div>

        <div class="option-group" id="campus-options">
          <h2>ìº í¼ìŠ¤ ì„ íƒ</h2>
          <span
            class="option"
            onclick="toggleOption(this, 'campus', 'ìˆ˜ì •ìº í¼ìŠ¤')"
            >ìˆ˜ì •ìº í¼ìŠ¤</span
          >
          <span
            class="option"
            onclick="toggleOption(this, 'campus', 'ìš´ì •ìº í¼ìŠ¤')"
            >ìš´ì •ìº í¼ìŠ¤</span
          >
        </div>

        <div class="option-group" id="price-options">
          <h2>ê¸ˆì•¡ëŒ€ ì„ íƒ</h2>
          <span class="option" onclick="toggleOption(this, 'price', 'low')"
            >10,000ì› ë¯¸ë§Œ</span
          >
          <span class="option" onclick="toggleOption(this, 'price', 'mid')"
            >10,000ì› ~ 20,000ì›</span
          >
          <span class="option" onclick="toggleOption(this, 'price', 'high')"
            >20,000ì› ì´ìƒ</span
          >
        </div>

        <div class="button-container">
          <button class="recommend-button" onclick="startLoading()">
            ì‹œì‘í•˜ê¸°
          </button>
        </div>
      </div>
    </main>

    <!-- ë¡œë”© í™”ë©´ -->
    <div class="loading-screen" id="loading-screen" style="display: none">
      <p id="loading-message"></p>
    </div>

    <div class="popup" id="popup">
      <button class="close-button" onclick="closePopup()">âœ–</button>
      <div class="popup-header">
        <p class="popup-title">ğŸ‰ëœë¤ì¶”ì²œ ê²°ê³¼ì…ë‹ˆë‹¤! ğŸ‰</p>
      </div>
      <div class="store-item">
        <img src="" alt="ì´ë¯¸ì§€" id="popup-image" class="store-img" />
        <div class="store-details">
          <div>
            <p id="popup-title" class="store-name">ê°€ê²Œ ì´ë¦„</p>
          </div>
          <div class="popup-buttons">
            <button
              class="details-button"
              onclick="window.location.href='store-details.html'"
            >
              ìì„¸íˆ ë³´ê¸°
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ë°˜ì‘í˜• -->
  </body>
<!-- ì‚¬ì´íŠ¸ ì•ˆë‚´ ë©”ì‹œì§€ -->
<div id="site-message">
  <button id="close-message">X</button>
  <p>í™˜ì˜í•©ë‹ˆë‹¤â¤ï¸<br> ì´ì œ ë” ì´ìƒ ê³ ë¯¼ì—†ì´ <br> ì›í•˜ëŠ” ì¡°ê±´ë§Œ ì„ íƒí•˜ë©´ ì‹ë‹¹ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>

  <button id="hide-today">ì˜¤ëŠ˜ì€ ë” ì´ìƒ ë³´ì§€ ì•Šê¸°</button>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const messageBox = document.getElementById("site-message");
    const closeBtn = document.getElementById("close-message");
    const hideTodayBtn = document.getElementById("hide-today");

    // localStorageì—ì„œ 'hideMessage' ê°’ í™•ì¸ (ê°’ì´ ìˆìœ¼ë©´ ìˆ¨ê¸°ê¸°)
    if (localStorage.getItem("hideMessage") === "true") {
      messageBox.style.display = "none";
    }

    // X ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ì‹œì§€ ì°½ ë‹«ê¸° (ì´ë²ˆë§Œ ë‹«í˜)
    closeBtn.addEventListener("click", function () {
      messageBox.style.display = "none";
    });

    // "ì˜¤ëŠ˜ì€ ë” ì´ìƒ ë³´ì§€ ì•Šê¸°" í´ë¦­ ì‹œ í•˜ë£¨ ë™ì•ˆ ìˆ¨ê¸°ê¸°
    hideTodayBtn.addEventListener("click", function () {
      localStorage.setItem("hideMessage", "true"); // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ìˆ¨ê¹€ ì„¤ì • ì €ì¥
      messageBox.style.display = "none"; // ë©”ì‹œì§€ ìˆ¨ê¹€
    });
  });
</script>



  <!-- Footer Placeholder -->
  <div id="footer-placeholder"></div>

  <script src="header_footer.js"></script>
</html>

<script>
  function startLoading() {
    document.getElementById("loading-message").textContent =
      "ê°€ê²Œë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...";
    document.getElementById("loading-screen").style.display = "flex";

    setTimeout(() => {
      document.getElementById("loading-screen").style.display = "none";
      showResults(); // ë¡œë”© í›„ ê²°ê³¼ í‘œì‹œ
    }, 2000);
  }

  const selections = {
    food: [],
    visit: "",
    price: "",
    campus: "",
  };

  function toggleOption(element, type, value) {
    const options = document.querySelectorAll(`#${type}-options .option`);

    if (type === "price" || type === "visit" || type === "campus") {
      // ë‹¨ì¼ ì„ íƒ ì˜µì…˜ ì²˜ë¦¬
      if (element.classList.contains("selected")) {
        // ì´ë¯¸ ì„ íƒëœ ê²½ìš° í•´ì œ
        element.classList.remove("selected");
        selections[type] = "";
      } else {
        // ì„ íƒ ì²˜ë¦¬
        options.forEach((option) => option.classList.remove("selected"));
        element.classList.add("selected");
        selections[type] = value;
      }
    } else if (type === "food") {
      // ë‹¤ì¤‘ ì„ íƒ ì˜µì…˜ ì²˜ë¦¬
      if (value === "ì „ì²´") {
        if (element.classList.contains("selected")) {
          // 'ì „ì²´'ê°€ ì´ë¯¸ ì„ íƒëœ ê²½ìš° í•´ì œ
          element.classList.remove("selected");
          selections.food = [];
        } else {
          // 'ì „ì²´' ì„ íƒ ì²˜ë¦¬
          options.forEach((option) => option.classList.remove("selected"));
          element.classList.add("selected");
          selections.food = ["ì „ì²´"];
        }
      } else {
        if (element.classList.contains("selected")) {
          // ê°œë³„ ì˜µì…˜ í•´ì œ
          element.classList.remove("selected");
          selections.food = selections.food.filter((item) => item !== value);
        } else {
          // 'ì „ì²´' í•´ì œ ë° ê°œë³„ ì˜µì…˜ ì„ íƒ
          options.forEach((option) => {
            if (option.textContent === "ì „ì²´") {
              option.classList.remove("selected");
            }
          });
          element.classList.add("selected");
          selections.food.push(value);
        }
      }
    }
    console.log(selections); // ë””ë²„ê¹… ì¶œë ¥
  }

  function showPopup(store) {
    const popup = document.getElementById("popup");

    // íŒì—… ë°ì´í„° ì„¤ì •


    document.getElementById("popup-image").src =
      store.image_url || "default-image.jpg";
    document.getElementById("popup-title").textContent =
      store.restaurant_name || "ê°€ê²Œ ì´ë¦„ ì—†ìŒ";

    // "ìì„¸íˆ ë³´ê¸°" ë²„íŠ¼ ë§í¬ ì„¤ì •
    const detailsButton = document.querySelector(".details-button");
    detailsButton.onclick = function () {
      window.location.href = `/store_details?id=${store.restaurant_id}`;
    };

    popup.style.display = "flex"; // íŒì—… ì—´ê¸°
  }

  function closePopup() {
    const popup = document.getElementById("popup");
    popup.style.display = "none"; // íŒì—… ë‹«ê¸°
  }

  async function showResults() {
    try {
      const queryParams = new URLSearchParams({
        food: selections.food.join(","), // ë°°ì—´ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì „ë‹¬
        visit: selections.visit || "",
        price: selections.price || "",
        campus: selections.campus || "",
      });

      const response = await fetch(`/get-random-restaurant?${queryParams}`);
      console.log("Request URL:", response.url);

      if (response.ok) {
        const restaurant = await response.json();
        showPopup(restaurant);
      } else {
        alert("ì¡°ê±´ì— ë§ëŠ” ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤.");
      }
    } catch (error) {
      console.error("Error fetching restaurant:", error);
    }
  }
</script>
