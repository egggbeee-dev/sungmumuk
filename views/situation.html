<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Restaurant Page</title>
    <link rel="icon" href="ì„±ë­ë¨¹3.png" type="image/png" />
    <link rel="stylesheet" href="situation.css" />
    <!-- ê¸°ì¡´ CSS íŒŒì¼ì„ ë§í¬ -->
    <link rel="stylesheet" href="header_footer.css" />
     <!-- ìŠ¤íƒ€ì¼ -->
     <link
     href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
     rel="stylesheet"
   />
  </head>
  <body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>
    <!-- ì œëª© ì„¹ì…˜ -->
    <div class="page-header">ìƒí™©ë³„ ê²€ìƒ‰</div>

    <!-- ì¤‘ê°„ ë¶€ë¶„ ì„¹ì…˜ (ë©”ë‰´ ê²€ìƒ‰ ë¶€ë¶„) -->
    <section class="middle-section">
      <div class="menu-buttons">
        <div class="menu-button" data-filter="í˜¼ë°¥">
          <span class="menu-icon">ğŸ™‹â€â™€ï¸</span>
          <p>í˜¼ë°¥</p>
        </div>
        <div class="menu-button" data-filter="ë‹¨ì²´">
          <span class="menu-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
          <p>ë‹¨ì²´</p>
        </div>
        <div class="menu-button" data-filter="ì¹´ê³µ">
          <span class="menu-icon">ğŸ‘©â€ğŸ’»</span>
          <p>ì¹´ê³µ</p>
        </div>
        <div class="menu-button" data-filter="ê°€ì„±ë¹„">
          <span class="menu-icon">ğŸ’¸</span>
          <p>ê°€ì„±ë¹„</p>
        </div>
        <div class="menu-button" data-filter="ë¶„ìœ„ê¸° ì¢‹ì€">
          <span class="menu-icon">ğŸ’</span>
          <p>ë¶„ìœ„ê¸° ì¢‹ì€</p>
        </div>
        <div class="menu-button" data-filter="ì‹¬ì•¼">
          <span class="menu-icon">ğŸŒƒ</span>
          <p>ì‹¬ì•¼</p>
        </div>
      </div>
    </section>

    <!-- ê°€ê²Œ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
    <section class="store-list-section">
      <div class="sort-container">
        <select id="sort-options" class="sort-dropdown">
          <option value="favorite">ì°œ ë§ì€ ìˆœ</option>
          <option value="review">ë¦¬ë·° ë§ì€ ìˆœ</option>
          <option value="sujeong">ìˆ˜ì •ìº í¼ìŠ¤</option>
          <option value="unjeong">ìš´ì •ìº í¼ìŠ¤</option>
        </select>
      </div>

      <!-- í•„í„°ë§ëœ ê°€ê²Œ ëª©ë¡ì´ ë Œë”ë§ë  ìœ„ì¹˜ -->
      <div id="store-list" class="store-list"></div>
    </section>

    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <script src="header_footer.js"></script>
    <script src="situation.js"></script>
    <!-- JavaScript íŒŒì¼ì„ ë§í¬ -->

    <!-- JavaScript ì½”ë“œ í¬í•¨ -->
    <script>
      const menuButtons = document.querySelectorAll(".menu-button");
      const sortDropdown = document.getElementById("sort-options");
      const storeListContainer = document.querySelector("#store-list");

      let currentFilter = "solo_meal"; // ì´ˆê¸° í•„í„° (í˜¼ë°¥)
      let currentSort = "review"; // ì´ˆê¸° ì •ë ¬ ìƒíƒœ (ë¦¬ë·° ë§ì€ ìˆœ)

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ í•„í„° ë° ì •ë ¬ ë°ì´í„° ìš”ì²­
      document.addEventListener("DOMContentLoaded", async () => {
        menuButtons[0].classList.add("active"); // ê¸°ë³¸ í•„í„° ë²„íŠ¼ í™œì„±í™”
        updateSortDropdown(); // ì •ë ¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        await fetchAndUpdateStores(); // ê¸°ë³¸ ë°ì´í„° ìš”ì²­
      });

      // ì •ë ¬ ì˜µì…˜ ë³€ê²½ ì‹œ ì´ë²¤íŠ¸
      sortDropdown.addEventListener("change", async () => {
        currentSort = sortDropdown.value; // ì„ íƒëœ ì •ë ¬ ê°’ì„ ì €ì¥
        await fetchAndUpdateStores(); // í˜„ì¬ í•„í„°ì™€ ì •ë ¬ë¡œ ë°ì´í„° ìš”ì²­
      });

      // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸
      menuButtons.forEach((button, index) => {
        button.addEventListener("click", async () => {
          menuButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");

          // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì— ë”°ë¼ í•„í„° ì„¤ì •
          switch (index) {
            case 0:
              currentFilter = "solo_meal";
              break;
            case 1:
              currentFilter = "group_meal";
              break;
            case 2:
              currentFilter = "cafe_study";
              break;
            case 3:
              currentFilter = "good_price";
              break;
            case 4:
              currentFilter = "good_mood";
              break;
            case 5:
              currentFilter = "late_night";
              break;
            default:
              currentFilter = "solo_meal";
              break;
          }

          await fetchAndUpdateStores(); // í˜„ì¬ í•„í„°ì™€ ì •ë ¬ë¡œ ë°ì´í„° ìš”ì²­
        });
      });

    // ë°ì´í„° ìš”ì²­ ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    async function fetchAndUpdateStores() {
    try {
        const response = await fetch(`/situation/api?filter=${encodeURIComponent(currentFilter)}&sort=${encodeURIComponent(currentSort)}`);
        if (!response.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜ ë°œìƒ');

        const data = await response.json();
        updateStoreList(data.stores); // ê°€ê²Œ ëª©ë¡ ê°±ì‹ 
    } catch (error) {
        console.error('ê°€ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    }
}

function updateStoreList(stores) {
    storeListContainer.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì‚­ì œ

    stores.forEach((store) => {
        const storeItem = document.createElement("div");
        storeItem.classList.add("store-item");

        storeItem.innerHTML = `
            <img src="${store.image_url || 'default.jpg'}" class="store-img" alt="${store.category}">
            <div class="store-details">
                <p class="store-name">${store.restaurant_name}</p>
                <button class="details-button" onclick="location.href='store_details?id=${store.restaurant_id}'">ìì„¸íˆ ë³´ê¸°</button>
            </div>
        `;
        storeListContainer.appendChild(storeItem);
    });
}

      // ì •ë ¬ ë“œë¡­ë‹¤ìš´ ìƒíƒœ ì—…ë°ì´íŠ¸
      function updateSortDropdown() {
        sortDropdown.value = currentSort; // í˜„ì¬ ì •ë ¬ ìƒíƒœë¥¼ ë“œë¡­ë‹¤ìš´ì— ë°˜ì˜
      }
    </script>

    <!-- ë°˜ì‘í˜• -->
  </body>
</html>
